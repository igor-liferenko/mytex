#!/bin/sh

# This script is called by viewer (if viewer uses lpr for printing).
# It wraps the content to PJL and sends to printer directly.

# NOTE: PDF is obtained from PS (not from DVI) to guarantee that
# \special constructs produce the same result

# Pages to be printed must be selected from viewer (and hence by viewer).
# In PS pages are separated from each other (contrary to PDF). To ensure
# that selected pages are identical to corresponding ones in original file,
# uncomment the following line and do diff of original file with
# /tmp/file.ps - the diff must show only non-selected pages.
#
# eval cp \${$#} /tmp/file.ps; exit

[ $# != 2 ] && exit 1; [ $1 != none ] && [ $1 != long ] && [ $1 != short ] && exit 1
(
  printf '\e%%-12345X'
  echo @PJL JOB
  if [ $1 = long ]; then
    echo @PJL SET DUPLEX=ON
  elif [ $1 = short ]; then
    echo @PJL SET DUPLEX=ON
    echo @PJL SET BINDING=SHORTEDGE
  fi
  echo @PJL SET RESOLUTION=600 # if you change this, change also pixels_per_inch
  echo @PJL ENTER LANGUAGE=POSTSCRIPT
  cat $2
  printf '\e%%-12345X'
  echo @PJL EOJ
  printf '\e%%-12345X'
) | ~/mytex/printer
