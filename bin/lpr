#!/bin/sh

# This script is called by viewer (viewer must use lpr for printing).

[ $# != 2 ] && exit 1; [ $1 != none ] && [ $1 != long ] && [ $1 != short ] && exit 1

# PostScript format makes it possible to separate pages without
# changing the rest of a document. Due to the simplicity of
# PostScript, this functionaly is implemented in any viewer.
# To ensure, that pages selected for printing in viewer are not changed,
# uncomment the following line and do diff of original file with /tmp/file.ps
# cp $2 /tmp/file.ps; exit

(
  printf '\e%%-12345X'
  echo @PJL JOB
  if [ $1 = long ]; then
    echo @PJL SET DUPLEX=ON
  elif [ $1 = short ]; then
    echo @PJL SET DUPLEX=ON
    echo @PJL SET BINDING=SHORTEDGE
  fi
  echo @PJL SET RESOLUTION=600 # if you change this, change also pixels_per_inch
  echo @PJL ENTER LANGUAGE=POSTSCRIPT
  cat $2
  printf '\e%%-12345X'
  echo @PJL EOJ
  printf '\e%%-12345X'
) | ~/mytex/printer
