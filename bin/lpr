#!/bin/sh

# This script is called by viewer (viewer must use lpr for printing).

[ $# != 2 ] && exit 1; [ $1 != none ] && [ $1 != long ] && [ $1 != short ] && exit 1

mkdir /tmp/mf.$$
resolution=$(cd /tmp/mf.$$; mf "\mode=localfont; mode_setup; show pixels_per_inch; end" | sed -n 's/>> //p')
rm -r /tmp/mf.$$

(
  printf '\33%%-12345X'
  echo @PJL JOB
  if [ $1 = long ]; then
    echo @PJL SET DUPLEX=ON
  elif [ $1 = short ]; then
    echo @PJL SET DUPLEX=ON
    echo @PJL SET BINDING=SHORTEDGE
  fi
  echo @PJL SET RESOLUTION=$resolution
  echo @PJL ENTER LANGUAGE=POSTSCRIPT
  cat $2
  printf '\33%%-12345X'
  echo @PJL EOJ
  printf '\33%%-12345X'
) | ~/mytex/printer
